# AUTOGENERATED! DO NOT EDIT! File to edit: nbdev_nbs/reader/spectronaut_reader.ipynb (unless otherwise specified).

__all__ = ['SpectronautReader']

# Cell
import pandas as pd
import numpy as np

from alphadeep.reader.psm_reader import \
    psm_reader_provider

from alphadeep.reader.maxquant_reader import \
    MaxQuantReader

class SpectronautReader(MaxQuantReader):
    def __init__(self):
        super().__init__()
        self.mod_sep = '[]'

        self.column_mapping = {
            'sequence': 'StrippedPeptide',
            'charge': 'PrecursorCharge',
            'RT': 'iRT',
            'CCS': 'CCS',
            'mobility': ['Mobility','IonMobility'],
            'proteins': 'Protein Name',
            'uniprot_ids': 'UniProtIds',
            'genes': 'Genes',
        }
        self.modseq_col = 'ModifiedPeptide'

    def _load_file(self, filename):
        df = pd.read_csv(filename, sep='\t')
        df.drop_duplicates([
            'ReferenceRun','ModifiedPeptide', 'PrecursorCharge'
        ], inplace=True)
        df.reset_index(drop=True, inplace=True)

        min_rt = df.iRT.min()
        df.iRT = (
            df.iRT - min_rt
        )/(df.iRT.max() - min_rt)
        return df



psm_reader_provider.register_reader(
    'spectronaut', SpectronautReader
)