---

title: Functionalities to calculate FDRs


keywords: fastai
sidebar: home_sidebar



nb_path: "nbdev_nbs/rescore/fdr.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbdev_nbs/rescore/fdr.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fdr_to_q_values" class="doc_header"><code>fdr_to_q_values</code><a href="https://github.com/MannLabs/peptdeep/tree/main/peptdeep/rescore/fdr.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fdr_to_q_values</code>(<strong><code>fdr_values</code></strong>:<code>ndarray</code>)</p>
</blockquote>
<p>convert FDR values to q_values.</p>
<p>Args:
    fdr_values (np.ndarray): FDR values, they should be
    sorted according to the descending order of the <code>score</code></p>
<p>Returns:
    np.ndarray: q_values</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_fdr" class="doc_header"><code>calc_fdr</code><a href="https://github.com/MannLabs/peptdeep/tree/main/peptdeep/rescore/fdr.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_fdr</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>score_column</code></strong>:<code>str</code>, <strong><code>decoy_column</code></strong>:<code>str</code>=<em><code>'decoy'</code></em>)</p>
</blockquote>
<p>Calculate FDR values (q_values in fact) for the given dataframe</p>
<p>Args:
    df (pd.DataFrame): PSM dataframe to calculate FDRs
    score_column (str): score column to sort in decending order
    decoy_column (str, optional): decoy column in the dataframe.
    1=target, 0=decoy. Defaults to 'decoy'.</p>
<p>Returns:
    pd.DataFrame: PSM dataframe with 'fdr' column added</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fdr_from_ref" class="doc_header"><code>fdr_from_ref</code><a href="https://github.com/MannLabs/peptdeep/tree/main/peptdeep/rescore/fdr.py#L62" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fdr_from_ref</code>(<strong><code>sorted_scores</code></strong>:<code>ndarray</code>, <strong><code>ref_scores</code></strong>:<code>ndarray</code>, <strong><code>ref_fdr_values</code></strong>:<code>ndarray</code>)</p>
</blockquote>
<p>Calculate FDR values from the given reference scores and fdr_values.
It is used to extend peptide-level or sequence-level FDR (reference)
to each PSM, as PSMs are more useful for quantification.</p>
<p>Args:
    sorted_scores (np.array): the scores to calculate FDRs,
      they must be sorted in decending order.
    ref_scores (np.array): reference scores that used to
      calculate ref_fdr_values, also sorted in decending order.
    ref_fdr_values (np.array): fdr values corresponding to ref_scores</p>
<p>Returns:
    np.array: fdr values corresponding to sorted_scores.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_fdr_from_ref" class="doc_header"><code>calc_fdr_from_ref</code><a href="https://github.com/MannLabs/peptdeep/tree/main/peptdeep/rescore/fdr.py#L95" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_fdr_from_ref</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>ref_scores</code></strong>:<code>ndarray</code>, <strong><code>ref_fdr_values</code></strong>:<code>ndarray</code>, <strong><code>score_column</code></strong>:<code>str</code>, <strong><code>decoy_column</code></strong>:<code>str</code>=<em><code>'decoy'</code></em>)</p>
</blockquote>
<p>Calculate FDR values for a PSM dataframe from the given reference
 scores and fdr_values. It is used to extend peptide-level or
 sequence-level FDR (reference) to each PSM, as PSMs are more useful
 for quantification.
``</p>
<p>Args:
    df (pd.DataFrame): PSM dataframe
    ref_scores (np.array): reference scores that used to
      calculate ref_fdr_values, also sorted in decending order.
    ref_fdr_values (np.array): fdr values corresponding to ref_scores
    score_column (str): score column in the dataframe
    decoy_column (str, optional): decoy column in the dataframe.
    1=target, 0=decoy. Defaults to 'decoy'.</p>
<p>Returns:
    pd.DataFrame: dataframe with 'fdr' column added</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mi">11</span><span class="p">,</span>
        <span class="s1">&#39;decoy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">f_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="o">*</span><span class="mf">9.9</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">f_score</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span>
            <span class="s1">&#39;decoy&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">f_score</span><span class="p">,</span>
            <span class="s1">&#39;decoy&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;decoy&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">calc_fdr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;decoy&#39;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>score</th>
      <th>decoy</th>
      <th>kind</th>
      <th>fdr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>347</th>
      <td>20.999467</td>
      <td>0</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>366</th>
      <td>20.978207</td>
      <td>0</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>266</th>
      <td>20.976567</td>
      <td>0</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>498</th>
      <td>20.900502</td>
      <td>0</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>213</th>
      <td>20.893660</td>
      <td>0</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1216</th>
      <td>0.064770</td>
      <td>0</td>
      <td>False</td>
      <td>0.504008</td>
    </tr>
    <tr>
      <th>669</th>
      <td>0.062011</td>
      <td>1</td>
      <td>False</td>
      <td>0.504505</td>
    </tr>
    <tr>
      <th>1169</th>
      <td>0.052011</td>
      <td>0</td>
      <td>False</td>
      <td>0.504505</td>
    </tr>
    <tr>
      <th>614</th>
      <td>0.038895</td>
      <td>1</td>
      <td>False</td>
      <td>0.505000</td>
    </tr>
    <tr>
      <th>1114</th>
      <td>0.028895</td>
      <td>0</td>
      <td>False</td>
      <td>0.505000</td>
    </tr>
  </tbody>
</table>
<p>1505 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">fdr</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">decoy</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>score</th>
      <th>decoy</th>
      <th>kind</th>
      <th>fdr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>347</th>
      <td>20.999467</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>366</th>
      <td>20.978207</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>266</th>
      <td>20.976567</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>498</th>
      <td>20.900502</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>213</th>
      <td>20.893660</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>312</th>
      <td>11.078605</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>493</th>
      <td>11.052031</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>487</th>
      <td>11.047116</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>363</th>
      <td>11.044195</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>428</th>
      <td>11.028248</td>
      <td>0</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>500 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

